# 屏光测试播放器 (Rhythm Light Test Player)

这是一个基于 Web 的音乐节奏可视化工具，能够根据音乐的节拍自动生成闪烁的屏幕光效。它通过后端分析音频的节奏点，在前端实现与音乐同步的视觉效果（全屏变色、分屏、网格等）。

主要用于屏幕测试、氛围营造或视觉体验。

## ✨ 主要功能

- **🎵 音乐节奏同步**：使用 `librosa` 库精确分析音乐节拍，实现视觉效果与音乐的完美同步。
- **🌈 多样化视觉效果**：支持全屏闪烁、水平/垂直分屏、九宫格、对角线切割等多种视觉模式。
- **🎨 动态色彩生成**：随机生成 HSL 色彩，并包含一定概率的黑/白闪烁效果，增强视觉冲击力。
- **📂 自动播放列表**：只需将音乐文件放入文件夹，前端即可自动识别，无需手动配置列表。
- **⚡ 实时生成数据**：支持在网页端直接为新歌生成节奏数据，无需后台手动运行脚本。
- **🐳 Docker 支持**：提供完整的 Docker 容器化方案，一键部署，开箱即用。
- **🇨🇳 全中文界面**：友好的中文操作界面。

## 🚀 快速开始 (Docker 推荐)

如果您安装了 Docker，这是最简单的运行方式。

1.  **启动服务**：
    双击运行目录下的 `start.bat`，或者在终端执行：
    ```bash
    docker compose up -d
    ```

2.  **访问应用**：
    打开浏览器访问：[http://localhost:18003](http://localhost:18003)

3.  **停止服务**：
    ```bash
    docker compose down
    ```

## 🛠️ 手动安装 (Python 环境)

如果您没有 Docker，也可以直接在 Python 环境中运行。

1.  **安装依赖**：
    你需要 Python 3.9+ 和 ffmpeg。
    ```bash
    pip install -r requirements.txt
    ```
    *注意：音频分析依赖 `librosa` 和 `ffmpeg`，请确保您的系统已安装 ffmpeg 并配置了环境变量。*

2.  **运行服务**：
    ```bash
    python server.py
    ```

3.  **访问**：
    打开浏览器访问：[http://localhost:8000](http://localhost:8000)

## 📖 使用指南

### 1. 添加音乐
只需将您的音频文件（支持 `.mp3`, `.wav`, `.ogg`, `.flac`）直接复制到项目根目录下的 `music/` 文件夹中。

### 2. 刷新列表
无需重启服务，直接在网页播放器界面点击 **“刷新”** 按钮，新添加的歌曲就会出现在下拉列表中。

### 3. 生成节奏
如果是新添加的歌曲，选择后界面会提示“未找到节奏数据”。
1.  在界面上调整 **灵敏度**（可选，默认 0.1）。
2.  点击 **“更新节奏”** 按钮。
3.  等待几秒钟，系统生成完毕后会自动开始播放。

### 4. 快捷键
- **点击屏幕**：播放/暂停
- **下拉框**：切换歌曲

## 📂 项目结构

```
.
├── music/                  # 存放音乐文件和生成的 .json 节奏数据
├── server.py               # FastAPI 后端服务器 (处理 API 和文件服务)
├── index.html              # 前端播放器界面
├── export_rhythm_data.py   # 核心节奏分析逻辑 (Librosa)
├── docker-compose.yml      # Docker 编排文件
├── Dockerfile              # Docker 镜像构建文件
├── requirements.txt        # Python 依赖列表
└── start.bat               # Windows 快速启动脚本
```

## ⚠️ 注意事项
- 本工具包含高频闪烁的视觉效果，**光敏性癫痫**患者请勿使用。
- 首次分析歌曲时可能需要几秒钟时间（取决于歌曲长度和机器性能）。
